<!DOCTYPE html>
<html>
  <head>
    <title>Space Invaders Study!</title>
  </head>
  <body>
    <h1> Round 2</h1>
    <iframe id="myIframe" allow="camera" width=1300 height=800></iframe>
    <p> </p>
    <p> </p>
    <!-- <div id="Next" style="display:none">
        <a href="questions2.html"> Next </a> 
    </div> -->
    <a id="nextPageLink" href="questions2.html">  </a>  

</body>

<script>
    function showNext() { 
        document.getElementById("Next").style.display = "inline"; 
    }
    setTimeout("showNext()", 30000);

    function findGetParameter(parameterName) {
        var result = null,
            tmp = [];
        var items = location.search.substr(1).split("&");
        for (var index = 0; index < items.length; index++) {
            tmp = items[index].split("=");
            if (tmp[0] === parameterName) result = tmp[1];
        }
        return result;
    }
    let game_port = 8667;
    let mode = 3;
    let game_num = 3;
    let condition = findGetParameter('condition') ? findGetParameter('condition') : 'C';
    let game_url = "http://localhost:"+game_port+"/";
    let player_id = findGetParameter('id') ? findGetParameter('id') : 'UNDEFINED';
    let full_url = game_url+"?id="+player_id+"&mode="+mode+"&game="+game_num+"&condition="+condition
    
    let myIframe = document.getElementById("myIframe")
    myIframe.src = full_url
</script>

    <script>
    var all_params = window.location.href.split('?')[1];
    var a = document.getElementsByTagName('a');
    for (var i=0; i < a.length; i++){
        a[i].href+="?";
        a[i].href+=all_params;
        console.log(a[i].href);
    }
    </script>
    <script src="../../src/game_files/static/js/gamepad.js"></script>
    <script>
     var all_params = window.location.href.split('?')[1];
     var a = document.getElementsByTagName('a');
     for (var i=0; i < a.length; i++){
       a[i].href+="?";
       a[i].href+=all_params;
       console.log(a[i].href);
     }
    
     var gamepad = false; // This variable will be used to track whether a gamepad is connected
    
     window.addEventListener("gamepadconnected", function(e) {
       // Set gamepad to true when any gamepad is connected
       gamepad = true;
     });
    
     window.addEventListener("gamepaddisconnected", function(e) {
       // Set gamepad to false when any gamepad is disconnected
       gamepad = false;
     });
    
     // This function will check for button B press and simulate a click on the link
     function checkButtonB() {
       if (gamepad) {
         // Get the first connected gamepad
         var gp = navigator.getGamepads()[0];
         if (gp && gp.buttons[1].pressed) {
           // Simulate a click on the link with ID "nextPageLink"
           var nextPageLink = document.getElementById("nextPageLink");
           if (nextPageLink) {
             nextPageLink.click();
           }
         }
       }
     }
    
     // Call the checkButtonB function every 100ms to continuously check for button B press
     setInterval(checkButtonB, 100);
    </script>
</html>